                          ***************************
                          *  Welcome to LambdaMOO!  *
                          ***************************
                                       
                      Running Version 1.8.3 of LambdaMOO

PLEASE NOTE:
   LambdaMOO is a new kind of society, where thousands of people voluntarily
come together from all over the world.  What these people say or do may not
always be to your liking; as when visiting any international city, it is wise
to be careful who you associate with and what you say.
   The operators of LambdaMOO have provided the materials for the buildings of
this community, but are not responsible for what is said or done in them.  In
particular, you must assume responsibility if you permit minors or others to
access LambdaMOO through your facilities.  The statements and viewpoints
expressed here are not necessarily those of the wizards, Pavel Curtis,
or Roger Crew, and those parties disclaim any responsibility for them.

NOTICE FOR JOURNALISTS AND RESEARCHERS:
  The citizens of LambdaMOO request that you ask for permission from all
direct participants before quoting any material collected here.

For assistance either now or later, type `help'.
The lag is low; there are 81 connected.
*** Connected ***
Storage room
Boxes, crates, scraps of stuff, and a dead rat are strewn about this small room. The air and everything else are dusty. Cough, cough. A hammock has been strung between two walls, and a single 60 watt bulb casts a dim light about the place.
There is new activity on the following lists:
    *Server-Hackers (#24451)             2 new messages
    *Core-DB-Issues (#8175)              1 new message
Last connected Sat Jun 20 12:53:39 2009 PDT from pontius.thatsnice.org
There is new news.  Type `news' to read all news or `news new' to read just new news.
===== *Server-Hackers (#24451) (2 messages) ==

Message 1126 on *Server-Hackers (#24451):
Date:     Mon Jul 20 13:42:52 2009 PDT
From:     Diopter (#98842)
To:       *Server-Hackers (#24451)

What does it take to make a NUM be 64 bits wide?

As a start, I looked at changing the declaration of Var.num to long long.
Before any changes, the declaration looks like:

typedef int32 Objid;

enum error {
    E_NONE, E_TYPE, E_DIV, E_PERM, E_PROPNF, E_VERBNF, E_VARNF, E_INVIND,
    E_RECMOVE, E_MAXREC, E_RANGE, E_ARGS, E_NACC, E_INVARG, E_QUOTA, E_FLOAT
};

struct Var {
    union {
        const char *str;        /* STR */
        int32 num;              /* NUM, CATCH, FINALLY */
        Objid obj;              /* OBJ */
        enum error err;         /* ERR */
        Var *list;              /* LIST */
        double *fnum;           /* FLOAT */
    } v;
    var_type type;
};

I notice everything in v is 4 bytes wide, and there's some code to force
pointers on Alphas to 32 bits.  I guess there's a reason for that...

dbio_read_var(void)
{
    Var r;
    
    r.type = (var_type) l;
    switch (l) {
    ...
    case TYPE_OBJ:
    case TYPE_ERR:
    case TYPE_INT:
    case TYPE_CATCH:
    case TYPE_FINALLY:
        r.v.num = dbio_read_num();
        break;
    ...
    return r;

Well, this is bad, because you can have unintentional
(and possibly incorrect, depending on the endianness of the
system) type punning if .num is wider than .err or .obj.

Anything else I need to be aware of?
--------------------------
Message 1127 on *Server-Hackers (#24451):
Date:     Mon Jul 20 13:47:01 2009 PDT
From:     Xeric (#112019)
To:       *Server-Hackers (#24451)

There are a lot of Vars in memory for a running server, which is why an effort was made to keep the size down.  You can make all of the int types (as you observed, you'll want to do ALL of them) into 64 bit at the cost of some memory.  At that point you could make float a non-ref type with no penalty.  The harder part is going to be finding all of the OTHER places in the server that say 'int32' when they mean 'type of Var.num', along with constant like MAXINT and so on.  So, for example, dbio_read_num() will load your "legacy" database full of 32 bit values, and then you might run fine, but until you modify something like dbio_write_num() to be 64 bit you won't be able to save your db if it has any 64-bit values.
--------------------------

===== *News (#123) (3 messages) ==============

Message 898 on *News (#123):
Date:     Wed Jul  1 00:00:00 2009 PDT
From:     ARB Elections Core (#52221)
To:       *News (#123)
Subject:  ARB Election Starts: Nominations now accepted
Sender:   Petitioner (#4)

   An election has begun for positions on the LambdaMOO Architecture Review Board currently being held by Skully (#93167), dtBy (#118322), Profane (#30788), and Kagan (#102427).  Nominations for the ballot will be accepted until Wednesday, July 15, at 12:00 am, LambdaMOO Standard Time, at which point a two-week voting period will begin if there are any candidates.  You can use the `@nominate <player-name> for ARB' command to start or sign a nominating petition for any player, including yourself.  See `help elections' for complete details on the process.
--------------------------
Message 899 on *News (#123):
Date:     Wed Jul 15 00:00:01 2009 PDT
From:     ARB Elections Core (#52221)
To:       *News (#123)
Subject:  ARB Election Starts: Nominations now accepted
Sender:   Petitioner (#4)

   An election has begun for positions on the LambdaMOO Architecture Review Board currently being held by Skully (#93167), dtBy (#118322), Profane (#30788), and Kagan (#102427).  Nominations for the ballot will be accepted until Wednesday, July 29, at 12:00 am, LambdaMOO Standard Time, at which point a two-week voting period will begin if there are any candidates.  You can use the `@nominate <player-name> for ARB' command to start or sign a nominating petition for any player, including yourself.  See `help elections' for complete details on the process.
--------------------------
Message 900 on *News (#123):
Date:     Wed Jul 15 00:00:01 2009 PDT
From:     ARB Elections Core (#52221)
To:       *News (#123)
Subject:  ARB Nomination Period Yields No Candidates
Sender:   Petitioner (#4)

   The ARB election nomination period that ended Wed Jul 15 00:00:00 2009 PDT failed to produce any candidates for the ballot, so the deadline has been extended by one more week.  See below for details.
--------------------------

===== *Core-DB-Issues (#8175) (1 message) ====

Message 5122 on *Core-DB-Issues (#8175):
Date:     Thu Jun  4 09:54:16 2009 PDT
From:     Dread (#123097)
To:       Nosredna (#2487) and *Core-DB-Issues (#8175)
Subject:  Re: traceback in claim in #68868

>  Date:     Tue May 12 05:58:57 2009 PDT
>  From:     Nosredna (#2487)
>  To:       Dread (#123097) and *Core-DB-Issues (#8175)
>  Subject:  Re: traceback in claim in #68868
>  
>  So, what did you try to claim?  It looks like it doesn't do good
>  arg checking, so if you mistyped the number and got an invalid
>  object instead, you'd get that error.  I suppose it should be
>  better...
I don't remember what items I was trying to claim when I encountered the error. I know that in the past when I try to claim an item that isn't claimable, I'll get a notification saying that the item can
can't be claimed, and no mail was sent. however the traceback happened with multiple object numbers (I tried one object, got the traceback, tried it again two more times and got the same traceback each time, then I tried two different object numbers and got the same traceback each time)
I can try to find the object I was trying to claim if it would help, but it might take a while to sift through the Everything shelf
--------------------------

===== End of new mail ========================
Did you get all of that? [Enter `yes' or `no']
< connected: Crag. Total: 82 >
Last-read-dates updated
15 messages on *Server-Hackers (#24451):
1113:  May 29 2007    Xeric (#112019)        I keep the WAIF branch in sf CVS u
1114:  May 29 2007    Puff (#1449)           Just an odd question; in the past 
1115:  Oct  3 2007    Diopter (#98842)       > Due to a certain massively impro
1116:  Oct  3 2007    Rog (#4292)            what happened
1117:  Nov 26 2007    Luke-Jr (#115349)      #-1 task perms?
1118:  Nov 26 2007    Luke-Jr (#115349)      MOO virtualization
1119:  Jan 31 2008    Luke-Jr (#115349)      GammaMOO 1.8.2g4
1120:  Sep 21 13:16   Winter_Wolf (#101504)   = Does anyone know about the prop
1121:  Oct 19 14:29   Rog (#4292)            Re: = Does anyone know about the p
1122:  Nov 25 03:14   Kenny (#53595)         Unicode support in MOO
1123:  Dec  4 07:11   Biafra (#61504)        Re: Unicode support in MOO
1124:  Dec  5 09:42   Kenny (#53595)         Re: Unicode support in MOO
1125:  Dec 21 08:14   Meyer (#116276)        Re: Unicode support in MOO
1126:  Jul 20 13:42   Diopter (#98842)       What does it take to make a NUM be
1127:  Jul 20 13:47   Xeric (#112019)        There are a lot of Vars in memory 
----+
Syntax:   @quicksend <player> [subj="<text>"] <one-line-message>...
          @quicksend <player> [subj="<text>"]

Synonym:  @qsend

The @quicksend command allows you to send a short mail message without heading for the mail room.  With the second form of the command you will be prompted for the body of the message (and a subject line unless your `nosubject' mailoption is set (see `help @mail-option') or you already gave a subject line).
Receiving mail from Crag (#58746) and forwarding it to your .email_address.
No News (is good news)
Message sent to Crag (#58746).
Message 1126 on *Server-Hackers (#24451):
Date:     Mon Jul 20 13:42:52 2009 PDT
From:     Diopter (#98842)
To:       *Server-Hackers (#24451)

What does it take to make a NUM be 64 bits wide?

As a start, I looked at changing the declaration of Var.num to long long.
Before any changes, the declaration looks like:

typedef int32 Objid;

enum error {
    E_NONE, E_TYPE, E_DIV, E_PERM, E_PROPNF, E_VERBNF, E_VARNF, E_INVIND,
    E_RECMOVE, E_MAXREC, E_RANGE, E_ARGS, E_NACC, E_INVARG, E_QUOTA, E_FLOAT
};

struct Var {
    union {
        const char *str;        /* STR */
        int32 num;              /* NUM, CATCH, FINALLY */
        Objid obj;              /* OBJ */
        enum error err;         /* ERR */
        Var *list;              /* LIST */
        double *fnum;           /* FLOAT */
    } v;
    var_type type;
};

I notice everything in v is 4 bytes wide, and there's some code to force
pointers on Alphas to 32 bits.  I guess there's a reason for that...

dbio_read_var(void)
{
    Var r;
    
    r.type = (var_type) l;
    switch (l) {
    ...
    case TYPE_OBJ:
    case TYPE_ERR:
    case TYPE_INT:
    case TYPE_CATCH:
    case TYPE_FINALLY:
        r.v.num = dbio_read_num();
        break;
    ...
    return r;

Well, this is bad, because you can have unintentional
(and possibly incorrect, depending on the endianness of the
system) type punning if .num is wider than .err or .obj.

Anything else I need to be aware of?
--------------------------
Message sent to *Server-Hackers (#24451).
*Server-Hackers (#24451) has just been sent new mail by Crag (#58746).
Message 1128 on *Server-Hackers (#24451):
Date:     Sat Jul 25 12:01:51 2009 PDT
From:     Crag (#58746)
To:       *Server-Hackers (#24451)
Subject:  Bigger NUMs

As an armchair server hacker, it seems like it would be more graceful to add a new type BIGNUM and hook it into libgmp.  You wouldn't have to worry about breaking any MOO code which assumes NUMs wrap around at 2**31 (you know it's out there) and you would just be adding another pointer to the Var.v union so you don't have to worry about alignment.
--------------------------
15 messages on *Server-Hackers (#24451):
1114:  May 29 2007    Puff (#1449)           Just an odd question; in the past 
1115:  Oct  3 2007    Diopter (#98842)       > Due to a certain massively impro
1116:  Oct  3 2007    Rog (#4292)            what happened
1117:  Nov 26 2007    Luke-Jr (#115349)      #-1 task perms?
1118:  Nov 26 2007    Luke-Jr (#115349)      MOO virtualization
1119:  Jan 31 2008    Luke-Jr (#115349)      GammaMOO 1.8.2g4
1120:  Sep 21 13:16   Winter_Wolf (#101504)   = Does anyone know about the prop
1121:  Oct 19 14:29   Rog (#4292)            Re: = Does anyone know about the p
1122:  Nov 25 03:14   Kenny (#53595)         Unicode support in MOO
1123:  Dec  4 07:11   Biafra (#61504)        Re: Unicode support in MOO
1124:  Dec  5 09:42   Kenny (#53595)         Re: Unicode support in MOO
1125:  Dec 21 08:14   Meyer (#116276)        Re: Unicode support in MOO
1126:  Jul 20 13:42   Diopter (#98842)       What does it take to make a NUM be
1127:  Jul 20 13:47   Xeric (#112019)        There are a lot of Vars in memory 
1128:  Jul 25 12:01   Crag (#58746)          Bigger NUMs
----+

