#!/usr/bin/env coffee

_ = require 'underscore'

{process, config, echo, warn, error, render} = require '../lib/cmdutils'
{env, argv} = process

[coffee, script, cmd, context, key, more...] = argv

usage = """
  Usage: #{cmd} get|set context key [value] [optionsJSON]
"""

if argv.length < 3
  error 1, "No request specified\n\n" + usage

if (_.intersection ['-h', '--help'], argv).length
  cmd = 'help'

switch cmd
  when 'help'
    echo usage

  when 'get'
    [opts] = more
    format = opts.format or 'shell'
    value = (config.get context, key) or ''
    echo render format, value

  when 'set'
    config.set context, key

  when 'shell_dump'
    echo config.dump 'shell'

  else
    error 1, "Unknown request '#{cmd}'\n\n" + usage
