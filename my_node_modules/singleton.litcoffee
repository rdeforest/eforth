    registry = new Map

    singleton = (ctor) ->
      if 'function' isnt typeof ctor
        throw new Error """
        usage:
          class ClassName
            constructor: singleton [keyFn], constructorFn
        """

      if not registry.has ctor
        registry.set ctor, db = new Map
      else
        db = registry.get ctor

      ctorWrapper = (args...) ->
        if exists = db.has args
          db.get args
        else
          db.set args, constructor.apply this, args

    if false
      class Named
        constructor: singleton (info = {}) ->
          {@name = this.constructor.name} = info

    module.exports = singleton

    module.exports.debug =
      known: allDbs
